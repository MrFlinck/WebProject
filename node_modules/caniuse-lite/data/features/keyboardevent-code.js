         //
            DeviceDisplayObject.QueryService(ref SID_EnumDeviceFunction, ref IID_IFunctionInstanceCollection, ref FICollectionPtr);
            if (IntPtr.Zero != FICollectionPtr)
            {
                FICollection = (IFunctionInstanceCollection)Marshal.GetObjectForIUnknown(FICollectionPtr);
                ResultCode = FICollection.GetCount(ref FunctionCount);

                for (UInt32 i = 0; i < FunctionCount; i++)
                {
                    ResultCode = FICollection.Item(i, ref FunctionInstancePtr);
                    if (IntPtr.Zero != FunctionInstancePtr)
                    {
                        FunctionInstance = (IFunctionInstance)Marshal.GetObjectForIUnknown(FunctionInstancePtr);

                        ResultCode = FunctionInstance.GetCategory(ref Category, ref SubCategory);
                        if (Category != null)
                        {
                            ResultCode = FunctionInstance.OpenPropertyStore(STGM_READ, ref PropertyStorePtr);
                            if (IntPtr.Zero != PropertyStorePtr)
                            {
                                PropertyStore = (IPropertyStore)Marshal.GetObjectForIUnknown(PropertyStorePtr);

                                ResultCode = PropertyStore.GetValue(ref PKEY_NAME, ref VariantData);
                                if (VarEnum.VT_EMPTY != VariantData.Type)
                                {
                                    ResultDeviceInfo.DeviceName = VariantData.Value.ToString();
